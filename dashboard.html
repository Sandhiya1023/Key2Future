<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PSGR KCW</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#5b2a5e">

<style>
:root {
    --wp--preset--font-size--extra-small: 16px;
    --wp--preset--font-size--small: 18px;
    --wp--preset--font-size--medium: 20px;
    --wp--preset--font-size--large: 24px;
    --wp--preset--font-size--x-large: 42px;
    --wp--preset--font-size--extra-large: 40px;
    --wp--preset--font-size--huge: 96px;
}

body{
    margin:0;
    font-family: Arial, sans-serif;
    font-size: var(--wp--preset--font-size--small);
    background: url("college_bg.jpg") no-repeat center center fixed;
    background-size: cover;
}

/* TOP HEADER BAR */
.top-header{
    background:#5b2a5e;
    padding:6px 8px;
}

.header-inner{
    display:flex;
    align-items:center;
    justify-content:space-between;
}

/* NAVIGATION MENU */
.nav-menu{
    display:flex;
    gap:20px;
    align-items:center;
}

.nav-menu a{
    color:white;
    text-decoration:none;
    font-size: var(--wp--preset--font-size--small);
    padding:8px 12px;
    border-radius:3px;
    transition:background 0.3s;
}

.nav-menu a:hover{
    background:rgba(255,255,255,0.2);
}

.user-info{
    color:white;
    font-size: var(--wp--preset--font-size--extra-small);
    margin-left:15px;
}

.main-content {
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
}

.content-wrapper {
    background: white;
    padding: 30px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.content-wrapper h2 {
    color: #5b2a5e;
    font-size: var(--wp--preset--font-size--large);
    margin-bottom: 20px;
    text-align: center;
}

.content-wrapper h3 {
    color: #5b2a5e;
    font-size: var(--wp--preset--font-size--medium);
    margin: 20px 0 10px 0;
}

.content-wrapper p {
    font-size: var(--wp--preset--font-size--small);
    line-height: 1.6;
    color: #333;
}

.content-wrapper ul {
    font-size: var(--wp--preset--font-size--small);
    color: #333;
}

.content-wrapper li {
    margin-bottom: 8px;
}

.home-links {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.link-item {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.3s;
    border: 1px solid #e9ecef;
}

.link-item:hover {
    background: #e9ecef;
}

.link-item h3 {
    color: #5b2a5e;
    margin: 0 0 10px 0;
    font-size: var(--wp--preset--font-size--medium);
}

.link-item p {
    margin: 0;
    color: #666;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    color: #5b2a5e;
    font-size: var(--wp--preset--font-size--small);
    font-weight: bold;
}

.form-group input,
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: var(--wp--preset--font-size--small);
    font-family: Arial, sans-serif;
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
    outline: none;
    border-color: #5b2a5e;
}

#helpdeskForm button,
#addCourseForm button {
    background: #5b2a5e;
    color: white;
    padding: 12px 30px;
    border: none;
    border-radius: 5px;
    font-size: var(--wp--preset--font-size--small);
    cursor: pointer;
    transition: background 0.3s;
    margin-right: 10px;
}

#helpdeskForm button:hover,
#addCourseForm button:hover {
    background: #7a3c7d;
}

.course-tabs {
    display: flex;
    margin-bottom: 20px;
    border-bottom: 1px solid #ddd;
}

.tab-btn {
    background: none;
    border: none;
    padding: 10px 20px;
    cursor: pointer;
    font-size: var(--wp--preset--font-size--small);
    color: #666;
    border-bottom: 2px solid transparent;
}

.tab-btn.active {
    color: #5b2a5e;
    border-bottom-color: #5b2a5e;
}

.course-tab-content {
    display: none;
}

.course-tab-content.active {
    display: block;
}

.course-item {
    background: #f8f9fa;
    padding: 20px;
    margin-bottom: 15px;
    border-radius: 8px;
    border: 1px solid #e9ecef;
}

.course-item h3 {
    margin: 0 0 10px 0;
    color: #5b2a5e;
}

.course-item p {
    margin: 5px 0;
}

.enroll-btn {
    background: #5b2a5e;
    color: white;
    padding: 8px 16px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: var(--wp--preset--font-size--small);
    margin-top: 10px;
}

.enroll-btn:hover {
    background: #7a3c7d;
}

.admin-controls {
    margin-bottom: 20px;
    text-align: center;
}

.admin-btn {
    background: #5b2a5e;
    color: white;
    padding: 8px 12px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: var(--wp--preset--font-size--extra-small);
    margin: 0 5px;
}

.admin-btn:hover {
    background: #7a3c7d;
}

.admin-btn.delete {
    background: #dc3545;
}

.admin-btn.delete:hover {
    background: #c82333;
}

.admin-course-controls {
    margin: 10px 0;
    padding: 10px;
    background: #f1f1f1;
    border-radius: 5px;
}

.admin-course-controls label {
    font-weight: bold;
    margin-right: 10px;
}

.limit-dropdown {
    padding: 5px;
    margin-right: 10px;
    border: 1px solid #ddd;
    border-radius: 3px;
}

.hidden-course {
    opacity: 0.5;
    border: 2px dashed #ccc;
}

.hidden-course h3::after {
    content: " (Hidden from Students)";
    color: #999;
    font-size: 14px;
    font-weight: normal;
}

.student-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #f8f9fa;
    padding: 15px;
    margin-bottom: 10px;
    border-radius: 5px;
    border: 1px solid #e9ecef;
}

.student-info {
    flex-grow: 1;
}

.student-name {
    font-size: var(--wp--preset--font-size--small);
    color: #333;
    margin-bottom: 5px;
}

.student-details {
    font-size: 14px;
    color: #666;
}

.remove-student-btn {
    background: #dc3545;
    color: white;
    padding: 6px 12px;
    border: none;
    border-radius: 3px;
    cursor: pointer;
    font-size: 14px;
}

.remove-student-btn:hover {
    background: #c82333;
}

.course-status-tabs {
    display: flex;
    margin: 20px 0;
    border-bottom: 1px solid #ddd;
}

.course-status-content {
    display: none;
    margin-top: 20px;
}

.course-status-content.active {
    display: block;
}

.course-status-item {
    background: #f8f9fa;
    padding: 15px;
    margin-bottom: 10px;
    border-radius: 5px;
    border-left: 4px solid #5b2a5e;
}

.course-status-item.completed {
    border-left-color: #28a745;
}

.course-status-item.ongoing {
    border-left-color: #ffc107;
}

.time-remaining {
    font-size: 14px;
    color: #666;
    margin-top: 5px;
}

.time-remaining.urgent {
    color: #dc3545;
    font-weight: bold;
}

.user-dropdown {
    position: relative;
    display: inline-block;
}

.user-dropdown .user-info {
    cursor: pointer;
    padding: 8px 12px;
    border-radius: 3px;
    transition: background 0.3s;
}

.user-dropdown .user-info:hover {
    background: rgba(255,255,255,0.2);
}

.dropdown-content {
    display: none;
    position: absolute;
    right: 0;
    background-color: white;
    min-width: 160px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
    border-radius: 5px;
    margin-top: 5px;
}

.dropdown-content a {
    color: #333 !important;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
    border-radius: 5px;
}

.dropdown-content a:hover {
    background-color: #f1f1f1;
}

/* LOGO IMAGE */
.logo img{
    height:65px;
}

.dept-batch-selection {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

.selection-btn {
    background: #5b2a5e;
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: var(--wp--preset--font-size--small);
    margin-top: 10px;
}

.selection-btn:hover {
    background: #7a3c7d;
}

.student-card {
    background: #f8f9fa;
    padding: 20px;
    margin-bottom: 20px;
    border-radius: 8px;
    border-left: 4px solid #5b2a5e;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.student-header {
    font-size: 18px;
    font-weight: bold;
    color: #5b2a5e;
    margin-bottom: 15px;
}

.course-section {
    margin-top: 10px;
}

.course-section h4 {
    margin: 10px 0 5px 0;
    color: #333;
    font-size: 16px;
}

.course-list .ongoing {
    background: #fff3cd;
    color: #856404;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    display: inline-block;
    margin: 2px;
    border: 1px solid #ffeaa7;
}

.course-list .completed {
    background: #d4edda;
    color: #155724;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    display: inline-block;
    margin: 2px;
    border: 1px solid #c3e6cb;
}
</style>
</head>

<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<div class="top-header">
    <div class="header-inner">
        <div class="logo">
            <img src="LOGO.png">
        </div>

        <div class="nav-menu">
            <a href="#" onclick="showSection('home')">Home</a>
            <a href="#" onclick="showSection('about')">About Us</a>
            <a href="#" onclick="showSection('courses')">Courses</a>
            <a href="#" onclick="showSection('details')">Get Details</a>
            <a href="#" onclick="showSection('helpdesk')">Helpdesk</a>
            <a href="#" onclick="logout()">Logout</a>
            <span class="user-info" id="userInfo">Logged in as: Admin</span>
        </div>
    </div>
</div>

<!-- MAIN CONTENT -->
<div class="main-content" id="content">
    <div class="home-section" id="home" style="display:block;">
        <div class="content-wrapper">
            <h2>Welcome to Online Course Database System</h2>
            <p>Manage your courses and academic information efficiently.</p>
            <br>
            <div class="home-links">
                <div class="link-item" onclick="showSection('courses')">
                    <h3>Browse Courses</h3>
                    <p>Explore available courses</p>
                </div>
                <div class="link-item" onclick="showSection('details')">
                    <h3>Student Details</h3>
                    <p>View student information</p>
                </div>
                <div class="link-item" onclick="showSection('helpdesk')">
                    <h3>Contact Us</h3>
                    <p>Get in touch with us</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="about-section" id="about" style="display:none;">
        <div class="content-wrapper">
            <h2>About Us</h2>
            <p style="text-align: justify; text-indent: 2em;">PSGR Krishnammal College for Women (KCW), established in June 1963 under the aegis of the GRG Trust, Coimbatore, is a premier institution dedicated to women's higher education. Guided by the motto "Empowering through Education," KCW has grown into a centre of academic excellence and holistic development over the past six decades. The college is an autonomous institution affiliated with Bharathiar University, Coimbatore, accredited with an A++ grade by NAAC, and recognized by the UGC as a College of Excellence.</p>
            <p style="text-align: justify; text-indent: 2em;">In alignment with its commitment to academic innovation and digital transformation, KCW presents the Online Course Database, a centralized web-based platform designed to provide structured access to the wide range of courses offered by the institution. The platform supports KCW's vision of inclusive and learner-centric education by organizing courses in a clear and systematic manner.</p>
            <p style="text-align: justify; text-indent: 2em;">The Online Course Database categorizes courses into Technical and Non-Technical streams, enabling students to explore academic, professional, and skill-development opportunities with clarity. Each course is presented with relevant details to help learners understand its scope and learning objectives.</p>
            <p style="text-align: justify; text-indent: 2em;">Developed with a user-friendly and intuitive interface, the platform ensures smooth navigation and easy access for students, faculty, and stakeholders. The database serves as a digital academic repository that reflects KCW's emphasis on quality education, accessibility, and continuous learning.</p>
            <p style="text-align: justify; text-indent: 2em;">Through this initiative, KCW reinforces its enduring mission to empower women by integrating technology with education and fostering informed academic choices in a dynamic learning environment.</p>
            <footer>
              <div class="footer-contact">
                <p><strong>Address:</strong> Peelamedu, Coimbatore - 641004, Tamil Nadu, India</p>
                <p><strong>Phone:</strong> +91 422 429 5959 / +91 422 429 5860</p>
                <p><strong>Admission Enquiry:</strong> +91 8049251252</p>
                <p><strong>Email:</strong> <a href="mailto:principal@psgrkcw.ac.in">principal@psgrkcw.ac.in</a></p>
                <p><strong>Location:</strong> 
                  <a href="https://www.google.com/maps/search/?api=1&query=PSGR+Krishnammal+College+for+Women,+Peelamedu,+Coimbatore+641004" target="_blank">
                    View on Google Maps
                  </a>
                </p>
              </div>
            </footer>
        </div>
    </div>
    
    <div class="helpdesk-section" id="helpdesk" style="display:none;">
        <div class="content-wrapper">
            <h2>Helpdesk</h2>
            <form id="helpdeskForm">
                <div class="form-group">
                    <label>Your Email</label>
                    <input type="email" id="userEmail" required>
                </div>
                <div class="form-group">
                    <label>Your Message</label>
                    <textarea id="userMessage" rows="5" required></textarea>
                </div>
                <button type="submit">SEND MESSAGE</button>
            </form>
        </div>
    </div>
    
    <div class="courses-section" id="courses" style="display:none;">
        <div class="content-wrapper">
            <h2>Courses</h2>
            <div class="admin-controls" id="adminControls" style="display:none;">
                <button class="admin-btn" onclick="addNewCourse()">Add New Course</button>
                <button class="admin-btn" onclick="showSection('uploadCourses')">Upload Excel</button>
                <button class="admin-btn" onclick="hideAllCourses()">Hide All Courses</button>
                <button class="admin-btn" onclick="showAllCourses()">Show All Courses</button>
            </div>
            <div class="course-tabs">
                <button class="tab-btn active" onclick="showCourseTab('all')">All Courses</button>
                <button class="tab-btn" onclick="showCourseTab('technical')">Technical</button>
                <button class="tab-btn" onclick="showCourseTab('non-technical')">Non-Technical</button>
            </div>
            <div class="course-content">
                <div id="all-courses" class="course-tab-content active">
                    <div class="course-item" data-course="python-programming">
                        <h3>Python Programming</h3>
                        <p><strong>Category:</strong> Technical</p>
                        <p><strong>Instructor:</strong> Dr. Smith</p>
                        <p>Learn Python from basics to advanced</p>
                        <div class="admin-course-controls" style="display:none;">
                            <label>Student Limit:</label>
                            <select class="limit-dropdown">
                                <option value="no-limit">No Limit</option>
                                <option value="50">50 Students</option>
                                <option value="100">100 Students</option>
                                <option value="150">150 Students</option>
                                <option value="200">200 Students</option>
                                <option value="250">250 Students</option>
                                <option value="above-250">Above 250</option>
                            </select>
                            <button class="admin-btn" onclick="editCourse('python-programming')">Edit</button>
                            <button class="admin-btn delete" onclick="deleteCourse('python-programming')">Delete</button>
                            <button class="admin-btn" onclick="toggleCourseVisibility('python-programming')">Hide</button>
                            <button class="admin-btn" onclick="manageStudents('Python Programming')">Manage Students</button>
                        </div>
                        <button class="enroll-btn" onclick="enrollCourse('Python Programming')">View/Enroll</button>
                    </div>
                    <div class="course-item" data-course="communication-skills">
                        <h3>Communication Skills</h3>
                        <p><strong>Category:</strong> Non-Technical</p>
                        <p><strong>Instructor:</strong> Ms. Davis</p>
                        <p>Improve your communication</p>
                        <div class="admin-course-controls" style="display:none;">
                            <label>Student Limit:</label>
                            <select class="limit-dropdown">
                                <option value="no-limit">No Limit</option>
                                <option value="50">50 Students</option>
                                <option value="100">100 Students</option>
                                <option value="150">150 Students</option>
                                <option value="200">200 Students</option>
                                <option value="250">250 Students</option>
                                <option value="above-250">Above 250</option>
                            </select>
                            <button class="admin-btn" onclick="editCourse('communication-skills')">Edit</button>
                            <button class="admin-btn delete" onclick="deleteCourse('communication-skills')">Delete</button>
                            <button class="admin-btn" onclick="toggleCourseVisibility('communication-skills')">Hide</button>
                            <button class="admin-btn" onclick="manageStudents('Communication Skills')">Manage Students</button>
                        </div>
                        <button class="enroll-btn" onclick="enrollCourse('Communication Skills')">View/Enroll</button>
                    </div>
                </div>
                <div id="technical-courses" class="course-tab-content">
                    <div class="course-item" data-course="python-programming">
                        <h3>Python Programming</h3>
                        <p><strong>Category:</strong> Technical</p>
                        <p><strong>Instructor:</strong> Dr. Smith</p>
                        <p>Learn Python from basics to advanced</p>
                        <button class="enroll-btn" onclick="enrollCourse('Python Programming')">View/Enroll</button>
                    </div>
                </div>
                <div id="non-technical-courses" class="course-tab-content">
                    <div class="course-item" data-course="communication-skills">
                        <h3>Communication Skills</h3>
                        <p><strong>Category:</strong> Non-Technical</p>
                        <p><strong>Instructor:</strong> Ms. Davis</p>
                        <p>Improve your communication</p>
                        <button class="enroll-btn" onclick="enrollCourse('Communication Skills')">View/Enroll</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="add-course-section" id="addCourse" style="display:none;">
        <div class="content-wrapper">
            <h2>Add New Course</h2>
            <form id="addCourseForm">
                <div class="form-group">
                    <label>Course Name</label>
                    <input type="text" id="courseName" required>
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="courseCategory" required>
                        <option value="">Select Category</option>
                        <option value="Technical">Technical</option>
                        <option value="Non-Technical">Non-Technical</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Instructor Name</label>
                    <input type="text" id="instructorName" required>
                </div>
                <div class="form-group">
                    <label>Course Description</label>
                    <textarea id="courseDescription" rows="4" required></textarea>
                </div>
                <div class="form-group">
                    <label>Student Limit</label>
                    <select id="studentLimit" required>
                        <option value="no-limit">No Limit</option>
                        <option value="50">50 Students</option>
                        <option value="100">100 Students</option>
                        <option value="150">150 Students</option>
                        <option value="200">200 Students</option>
                        <option value="250">250 Students</option>
                        <option value="above-250">Above 250</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Duration (hours)</label>
                    <input type="number" id="courseDuration" min="0" max="500" value="0" required>
                </div>
                <div class="form-group">
                    <label>Duration (minutes)</label>
                    <input type="number" id="courseDurationMinutes" min="1" max="59" required>
                </div>
                <div class="form-group">
                    <label>Prerequisites</label>
                    <textarea id="coursePrerequisites" rows="2" placeholder="Enter prerequisites (optional)"></textarea>
                </div>
                <button type="submit">Create Course</button>
                <button type="button" onclick="showSection('courses')">Cancel</button>
            </form>
        </div>
    </div>
    
    <div class="student-management-section" id="studentManagement" style="display:none;">
        <div class="content-wrapper">
            <h2 id="managementTitle">Manage Students</h2>
            <div id="studentList"></div>
            <button type="button" onclick="showSection('courses')">Back to Courses</button>
        </div>
    </div>
    
    <div class="enrollment-form-section" id="enrollmentForm" style="display:none;">
        <div class="content-wrapper">
            <h2 id="enrollmentCourseTitle">Course Enrollment</h2>
            <form id="studentEnrollmentForm">
                <div class="form-group">
                    <label>Department</label>
                    <select id="studentDepartment" required>
                        <option value="">Select Department</option>
                        <option value="English">English</option>
                        <option value="History">History</option>
                        <option value="Economics">Economics</option>
                        <option value="Applied Economics">Applied Economics</option>
                        <option value="Physics">Physics</option>
                        <option value="Chemistry">Chemistry</option>
                        <option value="Botany">Botany</option>
                        <option value="Zoology">Zoology</option>
                        <option value="Mathematics">Mathematics</option>
                        <option value="Biotechnology">Biotechnology</option>
                        <option value="Psychology">Psychology</option>
                        <option value="Applied Psychology">Applied Psychology</option>
                        <option value="Food Processing Technology & Management">Food Processing Technology &amp; Management</option>
                        <option value="Beauty & Wellness">Beauty &amp; Wellness</option>
                        <option value="Costume Design & Fashion">Costume Design &amp; Fashion</option>
                        <option value="Fashion & Apparel Design">Fashion &amp; Apparel Design</option>
                        <option value="Data Science">Data Science</option>
                        <option value="Computer Science">Computer Science</option>
                        <option value="Computer Science (Artificial Intelligence)">Computer Science (Artificial Intelligence)</option>
                        <option value="Computer Science (Cognitive Systems)">Computer Science (Cognitive Systems)</option>
                        <option value="Computer Science (Cyber Security)">Computer Science (Cyber Security)</option>
                        <option value="Computer Science (Graphics & Creative Designing)">Computer Science (Graphics &amp; Creative Designing)</option>
                        <option value="Information Technology">Information Technology</option>
                        <option value="Data Analytics">Data Analytics</option>
                        <option value="Commerce">Commerce</option>
                        <option value="Commerce (Computer Applications)">Commerce (Computer Applications)</option>
                        <option value="Commerce (Accounting & Finance)">Commerce (Accounting &amp; Finance)</option>
                        <option value="Commerce (Actuarial Management)">Commerce (Actuarial Management)</option>
                        <option value="Commerce (Business Analytics)">Commerce (Business Analytics)</option>
                        <option value="Commerce (E-Commerce)">Commerce (E-Commerce)</option>
                        <option value="Commerce (Financial Services)">Commerce (Financial Services)</option>
                        <option value="Commerce (Fintech)">Commerce (Fintech)</option>
                        <option value="Business Administration">Business Administration</option>
                        <option value="Business Process Management">Business Process Management</option>
                        <option value="International Business">International Business</option>
                        <option value="Retail Management">Retail Management</option>
                        <option value="Management Studies">Management Studies</option>
                        <option value="Management of Financial Services">Management of Financial Services</option>
                        <option value="Library & Information Science">Library &amp; Information Science</option>
                        <option value="Physical Education">Physical Education</option>
                        <option value="Garment Designing">Garment Designing</option>
                        <option value="Others">Others</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Batch</label>
                    <select id="studentBatch" required>
                        <option value="">Select Batch</option>
                    </select>
                </div>
                <button type="submit">Enroll in Course</button>
                <button type="button" onclick="showSection('courses')">Cancel</button>
            </form>
        </div>
    </div>
    
    <div class="enrollment-success-section" id="enrollmentSuccess" style="display:none;">
        <div class="content-wrapper">
            <h2>Enrollment Successful!</h2>
            <div id="enrollmentDetails"></div>
            <button type="button" onclick="showSection('home')">Back to Home</button>
        </div>
    </div>
    
    <div class="edit-course-section" id="editCourse" style="display:none;">
        <div class="content-wrapper">
            <h2>Edit Course</h2>
            <form id="editCourseForm">
                <div class="form-group">
                    <label>Course Name</label>
                    <input type="text" id="editCourseName" required>
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="editCourseCategory" required>
                        <option value="">Select Category</option>
                        <option value="Technical">Technical</option>
                        <option value="Non-Technical">Non-Technical</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Instructor Name</label>
                    <input type="text" id="editInstructorName" required>
                </div>
                <div class="form-group">
                    <label>Course Description</label>
                    <textarea id="editCourseDescription" rows="4" required></textarea>
                </div>
                <div class="form-group">
                    <label>Student Limit</label>
                    <select id="editStudentLimit" required>
                        <option value="no-limit">No Limit</option>
                        <option value="50">50 Students</option>
                        <option value="100">100 Students</option>
                        <option value="150">150 Students</option>
                        <option value="200">200 Students</option>
                        <option value="250">250 Students</option>
                        <option value="above-250">Above 250</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Duration (hours)</label>
                    <input type="number" id="editCourseDuration" min="0" max="500" required>
                </div>
                <div class="form-group">
                    <label>Duration (minutes)</label>
                    <input type="number" id="editCourseDurationMinutes" min="1" max="59" required>
                </div>
                <div class="form-group">
                    <label>Prerequisites</label>
                    <textarea id="editCoursePrerequisites" rows="2" placeholder="Enter prerequisites (optional)"></textarea>
                </div>
                <button type="submit">Update Course</button>
                <button type="button" onclick="showSection('courses')">Cancel</button>
            </form>
        </div>
    </div>
    
    <div class="enrollment-confirmation-section" id="enrollmentConfirmation" style="display:none;">
        <div class="content-wrapper">
            <h2 id="confirmationCourseTitle">Course Enrollment Confirmation</h2>
            <div id="profileView">
                <h3>Your Profile</h3>
                <div id="profileDetails"></div>
            </div>
            <button type="button" id="confirmEnrollBtn" onclick="confirmEnrollment()">Enroll in Course</button>
            <button type="button" onclick="showSection('courses')">Cancel</button>
        </div>
    </div>
    
    <div class="student-details-section" id="studentDetails" style="display:none;">
        <div class="content-wrapper">
            <h2>Student Details</h2>
            <div id="studentInfo"></div>
            <div class="course-status-tabs">
                <button class="tab-btn active" onclick="showCourseStatus('ongoing')">Ongoing Courses</button>
                <button class="tab-btn" onclick="showCourseStatus('completed')">Completed Courses</button>
            </div>
            <div id="ongoingCourses" class="course-status-content active"></div>
            <div id="completedCourses" class="course-status-content"></div>
            <button type="button" onclick="showSection('home')">Back to Home</button>
        </div>
    </div>
    
    <div class="details-section" id="details" style="display:none;">
        <div class="content-wrapper">
            <h2>Get Student Details</h2>
            <div class="dept-batch-selection">
                <div class="form-group">
                    <label>Select Department</label>
                    <select id="detailsDepartment" required>
                        <option value="">Select Department</option>
                        <option value="All Departments">All Departments</option>
                        <option value="English">English</option>
                        <option value="History">History</option>
                        <option value="Economics">Economics</option>
                        <option value="Applied Economics">Applied Economics</option>
                        <option value="Physics">Physics</option>
                        <option value="Chemistry">Chemistry</option>
                        <option value="Botany">Botany</option>
                        <option value="Zoology">Zoology</option>
                        <option value="Mathematics">Mathematics</option>
                        <option value="Biotechnology">Biotechnology</option>
                        <option value="Psychology">Psychology</option>
                        <option value="Applied Psychology">Applied Psychology</option>
                        <option value="Food Processing Technology & Management">Food Processing Technology &amp; Management</option>
                        <option value="Beauty & Wellness">Beauty &amp; Wellness</option>
                        <option value="Costume Design & Fashion">Costume Design &amp; Fashion</option>
                        <option value="Fashion & Apparel Design">Fashion &amp; Apparel Design</option>
                        <option value="Data Science">Data Science</option>
                        <option value="Computer Science">Computer Science</option>
                        <option value="Computer Science (Artificial Intelligence)">Computer Science (Artificial Intelligence)</option>
                        <option value="Computer Science (Cognitive Systems)">Computer Science (Cognitive Systems)</option>
                        <option value="Computer Science (Cyber Security)">Computer Science (Cyber Security)</option>
                        <option value="Computer Science (Graphics & Creative Designing)">Computer Science (Graphics &amp; Creative Designing)</option>
                        <option value="Information Technology">Information Technology</option>
                        <option value="Data Analytics">Data Analytics</option>
                        <option value="Commerce">Commerce</option>
                        <option value="Commerce (Computer Applications)">Commerce (Computer Applications)</option>
                        <option value="Commerce (Accounting & Finance)">Commerce (Accounting &amp; Finance)</option>
                        <option value="Commerce (Actuarial Management)">Commerce (Actuarial Management)</option>
                        <option value="Commerce (Business Analytics)">Commerce (Business Analytics)</option>
                        <option value="Commerce (E-Commerce)">Commerce (E-Commerce)</option>
                        <option value="Commerce (Financial Services)">Commerce (Financial Services)</option>
                        <option value="Commerce (Fintech)">Commerce (Fintech)</option>
                        <option value="Business Administration">Business Administration</option>
                        <option value="Business Process Management">Business Process Management</option>
                        <option value="International Business">International Business</option>
                        <option value="Retail Management">Retail Management</option>
                        <option value="Management Studies">Management Studies</option>
                        <option value="Management of Financial Services">Management of Financial Services</option>
                        <option value="Library & Information Science">Library &amp; Information Science</option>
                        <option value="Physical Education">Physical Education</option>
                        <option value="Garment Designing">Garment Designing</option>
                        <option value="Others">Others</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Select Batch</label>
                    <select id="detailsBatch" required>
                        <option value="">Select Batch</option>
                    </select>
                </div>
            </div>
            <button class="selection-btn" onclick="showStudentsByDeptBatch()">View Students</button>
            <button class="selection-btn" onclick="showSection('uploadStudents')">Upload Student Data</button>
            <button class="selection-btn" id="undoBtn" onclick="undoLastUpload()" style="background: #dc3545; display: none;">Undo Last Upload</button>
            <button class="selection-btn" onclick="deleteAllExceptStudent1()" style="background: #dc3545;">Delete All Except student1</button>
        </div>
    </div>
    
    <div class="student-report-section" id="studentReport" style="display:none;">
        <div class="content-wrapper">
            <h2 id="reportTitle">Student Report</h2>
            <div id="studentReportTable"></div>
            <button type="button" onclick="showSection('details')">Back to Selection</button>
        </div>
    </div>
    
    <div class="upload-courses-section" id="uploadCourses" style="display:none;">
        <div class="content-wrapper">
            <h2>Upload Courses from Excel</h2>
            <p>Upload an Excel file with course data. Required columns: Name, Category, Instructor, Description, Limit, Duration (hours), Duration (minutes), Prerequisites</p>
            <p><a href="#" onclick="downloadSampleExcel()" style="color: #5b2a5e; text-decoration: underline;">Download Sample Excel File</a></p>
            <div class="form-group">
                <label>Select Excel File</label>
                <input type="file" id="excelFile" accept=".xlsx,.xls" required>
            </div>
            <button class="selection-btn" onclick="uploadExcelCourses()">Upload Courses</button>
            <button type="button" onclick="showSection('courses')">Cancel</button>
        </div>
    </div>
    
    <div class="upload-students-section" id="uploadStudents" style="display:none;">
        <div class="content-wrapper">
            <h2>Upload Student Data from Excel</h2>
            <p>Upload an Excel file with student enrollment data. Required columns: Username, Student Name, Department, Batch, Course Ongoing, Course Completed</p>
            <p><strong>Note:</strong> Student login accounts will be automatically created with username as password (e.g., Username: John1, Password: John1)</p>
            <p><a href="#" onclick="downloadSampleStudentExcel()" style="color: #5b2a5e; text-decoration: underline;">Download Sample Excel File</a></p>
            <div class="form-group">
                <label>Select Excel File</label>
                <input type="file" id="studentExcelFile" accept=".xlsx,.xls" required>
            </div>
            <button class="selection-btn" onclick="uploadExcelStudents()">Upload Student Data</button>
            <button type="button" onclick="showSection('details')">Cancel</button>
        </div>
    </div>
    


</div>

<script>
function showSection(section) {
    // Hide all sections
    document.getElementById('home').style.display = 'none';
    document.getElementById('about').style.display = 'none';
    document.getElementById('helpdesk').style.display = 'none';
    document.getElementById('courses').style.display = 'none';
    document.getElementById('addCourse').style.display = 'none';
    document.getElementById('studentManagement').style.display = 'none';
    document.getElementById('enrollmentForm').style.display = 'none';
    document.getElementById('enrollmentSuccess').style.display = 'none';
    document.getElementById('editCourse').style.display = 'none';
    document.getElementById('enrollmentConfirmation').style.display = 'none';
    document.getElementById('studentDetails').style.display = 'none';
    document.getElementById('details').style.display = 'none';
    document.getElementById('studentReport').style.display = 'none';
    document.getElementById('uploadCourses').style.display = 'none';
    document.getElementById('uploadStudents').style.display = 'none';
    
    // Show selected section
    if (section === 'home') {
        document.getElementById('home').style.display = 'block';
    } else if (section === 'about') {
        document.getElementById('about').style.display = 'block';
    } else if (section === 'helpdesk') {
        document.getElementById('helpdesk').style.display = 'block';
    } else if (section === 'courses') {
        document.getElementById('courses').style.display = 'block';
    } else if (section === 'addCourse') {
        document.getElementById('addCourse').style.display = 'block';
    } else if (section === 'studentManagement') {
        document.getElementById('studentManagement').style.display = 'block';
    } else if (section === 'enrollmentForm') {
        document.getElementById('enrollmentForm').style.display = 'block';
    } else if (section === 'enrollmentSuccess') {
        document.getElementById('enrollmentSuccess').style.display = 'block';
    } else if (section === 'editCourse') {
        document.getElementById('editCourse').style.display = 'block';
    } else if (section === 'enrollmentConfirmation') {
        document.getElementById('enrollmentConfirmation').style.display = 'block';
    } else if (section === 'studentDetails') {
        document.getElementById('studentDetails').style.display = 'block';
        showStudentDetailsPage();
    } else if (section === 'details') {
        const loginType = localStorage.getItem('loginType');
        if (loginType === 'admin') {
            document.getElementById('details').style.display = 'block';
        } else {
            document.getElementById('studentDetails').style.display = 'block';
            showStudentDetailsPage();
        }
    } else if (section === 'studentReport') {
        document.getElementById('studentReport').style.display = 'block';
    } else if (section === 'uploadCourses') {
        document.getElementById('uploadCourses').style.display = 'block';
    } else if (section === 'uploadStudents') {
        document.getElementById('uploadStudents').style.display = 'block';
    }
}

function showCourseTab(tab) {
    // Hide all course tabs
    document.querySelectorAll('.course-tab-content').forEach(content => {
        content.classList.remove('active');
    });
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Show selected tab
    if (tab === 'all') {
        document.getElementById('all-courses').classList.add('active');
        document.querySelector('.tab-btn').classList.add('active');
    } else if (tab === 'technical') {
        document.getElementById('technical-courses').classList.add('active');
        document.querySelectorAll('.tab-btn')[1].classList.add('active');
    } else if (tab === 'non-technical') {
        document.getElementById('non-technical-courses').classList.add('active');
        document.querySelectorAll('.tab-btn')[2].classList.add('active');
    }
}

function enrollCourse(courseName) {
    const loginType = localStorage.getItem('loginType');
    const username = localStorage.getItem('username');
    
    if (loginType === 'student') {
        // Check if student already enrolled
        const enrollments = JSON.parse(localStorage.getItem('courseEnrollments') || '{}');
        if (!enrollments[courseName]) {
            enrollments[courseName] = [];
        }
        
        const existingStudent = enrollments[courseName].find(student => student.username === username);
        if (existingStudent) {
            alert(`You are already enrolled in "${courseName}"!\n\nPlease try enrolling in some other available courses.`);
            return;
        }
        
        // Check if student has existing profile from previous enrollments
        let studentProfile = null;
        for (const course in enrollments) {
            const student = enrollments[course].find(s => s.username === username);
            if (student) {
                studentProfile = { department: student.department, batch: student.batch };
                break;
            }
        }
        
        if (studentProfile) {
            // Show profile in view mode on separate page
            localStorage.setItem('enrollingCourse', courseName);
            document.getElementById('confirmationCourseTitle').textContent = `Enroll in: ${courseName}`;
            document.getElementById('profileDetails').innerHTML = `
                <p><strong>Student:</strong> ${username}</p>
                <p><strong>Department:</strong> ${studentProfile.department}</p>
                <p><strong>Batch:</strong> ${studentProfile.batch}</p>
            `;
            showSection('enrollmentConfirmation');
        } else {
            // First time enrollment - show form
            localStorage.setItem('enrollingCourse', courseName);
            document.getElementById('enrollmentCourseTitle').textContent = `Enroll in: ${courseName}`;
            document.getElementById('studentDepartment').value = '';
            document.getElementById('studentBatch').value = '';
            // Generate batch options based on the course
            generateBatchOptions(courseName);
            showSection('enrollmentForm');
        }
    } else {
        // Admin view - show enrollment count and student details option
        const enrollments = JSON.parse(localStorage.getItem('courseEnrollments') || '{}');
        const enrolledStudents = enrollments[courseName] || [];
        const count = enrolledStudents.length;
        
        if (confirm(`Course: ${courseName}\nEnrolled Students: ${count}\n\nClick OK to view student details`)) {
            showStudentDetails(courseName);
        }
    }
}

function confirmEnrollment() {
    const courseName = localStorage.getItem('enrollingCourse');
    const username = localStorage.getItem('username');
    
    // Get existing profile
    const enrollments = JSON.parse(localStorage.getItem('courseEnrollments') || '{}');
    let studentProfile = null;
    for (const course in enrollments) {
        const student = enrollments[course].find(s => s.username === username);
        if (student) {
            studentProfile = { department: student.department, batch: student.batch };
            break;
        }
    }
    
    if (studentProfile) {
        // Enroll with existing profile
        if (!enrollments[courseName]) {
            enrollments[courseName] = [];
        }
        
        enrollments[courseName].push({
            username: username,
            department: studentProfile.department,
            batch: studentProfile.batch,
            enrolledDate: new Date().toISOString()
        });
        localStorage.setItem('courseEnrollments', JSON.stringify(enrollments));
        
        // Show success page
        document.getElementById('enrollmentDetails').innerHTML = `
            <p><strong>Course:</strong> ${courseName}</p>
            <p><strong>Student:</strong> ${username}</p>
            <p><strong>Department:</strong> ${studentProfile.department}</p>
            <p><strong>Batch:</strong> ${studentProfile.batch}</p>
            <p style="color: green; font-weight: bold;">You have been successfully enrolled!</p>
        `;
        
        localStorage.removeItem('enrollingCourse');
        showSection('enrollmentSuccess');
    }
}

function showStudentDetails(courseName) {
    const enrollments = JSON.parse(localStorage.getItem('courseEnrollments') || '{}');
    const enrolledStudents = enrollments[courseName] || [];
    
    let studentList = 'Students enrolled in ' + courseName + ':\n\n';
    if (enrolledStudents.length === 0) {
        studentList += 'No students enrolled.';
    } else {
        enrolledStudents.forEach((student, index) => {
            studentList += (index + 1) + '. ' + student + '\n';
        });
        studentList += '\nEnter student name to remove (or click Cancel):';
        
        const studentToRemove = prompt(studentList);
        if (studentToRemove && enrolledStudents.includes(studentToRemove)) {
            if (confirm(`Remove ${studentToRemove} from ${courseName}?`)) {
                enrollments[courseName] = enrollments[courseName].filter(student => student !== studentToRemove);
                localStorage.setItem('courseEnrollments', JSON.stringify(enrollments));
                alert(`${studentToRemove} has been removed from ${courseName}`);
            }
        } else if (studentToRemove) {
            alert('Student not found in this course.');
        }
    }
    
    if (enrolledStudents.length === 0) {
        alert(studentList);
    }
}

function addNewCourse() {
    showSection('addCourse');
}

function editCourse(courseId) {
    // Find course data in localStorage first
    let savedCourses = JSON.parse(localStorage.getItem('savedCourses') || '[]');
    let courseData = savedCourses.find(course => 
        course.name.toLowerCase().replace(/\s+/g, '-') === courseId
    );
    
    // If not found in localStorage, check if it's a default course
    if (!courseData) {
        const defaultCourses = {
            'python-programming': {
                name: 'Python Programming',
                category: 'Technical',
                instructor: 'Dr. Smith',
                description: 'Learn Python from basics to advanced',
                limit: 'no-limit',
                duration: 2,
                durationMinutes: 30,
                prerequisites: ''
            },
            'communication-skills': {
                name: 'Communication Skills',
                category: 'Non-Technical',
                instructor: 'Ms. Davis',
                description: 'Improve your communication',
                limit: 'no-limit',
                duration: 1,
                durationMinutes: 45,
                prerequisites: ''
            }
        };
        
        courseData = defaultCourses[courseId];
        if (courseData) {
            // Add default course to localStorage for editing
            savedCourses.push(courseData);
            localStorage.setItem('savedCourses', JSON.stringify(savedCourses));
        }
    }
    
    if (courseData) {
        // Pre-fill form with existing data
        document.getElementById('editCourseName').value = courseData.name;
        document.getElementById('editCourseCategory').value = courseData.category;
        document.getElementById('editInstructorName').value = courseData.instructor;
        document.getElementById('editCourseDescription').value = courseData.description;
        document.getElementById('editStudentLimit').value = courseData.limit;
        document.getElementById('editCourseDuration').value = courseData.duration || 0;
        document.getElementById('editCourseDurationMinutes').value = courseData.durationMinutes || 1;
        document.getElementById('editCoursePrerequisites').value = courseData.prerequisites || '';
        
        // Store original course ID for updating
        localStorage.setItem('editingCourseId', courseId);
        showSection('editCourse');
    }
}

function deleteCourse(courseId) {
    if (confirm('Are you sure you want to delete this course?')) {
        // Remove from localStorage
        const savedCourses = JSON.parse(localStorage.getItem('savedCourses') || '[]');
        const updatedCourses = savedCourses.filter(course => 
            course.name.toLowerCase().replace(/\s+/g, '-') !== courseId
        );
        localStorage.setItem('savedCourses', JSON.stringify(updatedCourses));
        
        // Remove from DOM
        const courseItems = document.querySelectorAll(`[data-course="${courseId}"]`);
        courseItems.forEach(item => item.remove());
        
        alert('Course deleted successfully!');
    }
}

function toggleCourseVisibility(courseId) {
    const courseItems = document.querySelectorAll(`[data-course="${courseId}"]`);
    const hiddenCourses = JSON.parse(localStorage.getItem('hiddenCourses') || '[]');
    
    courseItems.forEach(item => {
        const hideBtn = item.querySelector('.admin-btn:nth-last-child(2)');
        
        if (hiddenCourses.includes(courseId)) {
            // Unhide course
            item.classList.remove('hidden-course');
            hideBtn.textContent = 'Hide';
            const index = hiddenCourses.indexOf(courseId);
            hiddenCourses.splice(index, 1);
        } else {
            // Hide course
            item.classList.add('hidden-course');
            hideBtn.textContent = 'Unhide';
            hiddenCourses.push(courseId);
        }
    });
    
    localStorage.setItem('hiddenCourses', JSON.stringify(hiddenCourses));
    updateStudentView();
}

function hideAllCourses() {
    const allCourseItems = document.querySelectorAll('.course-item');
    const hiddenCourses = [];
    
    allCourseItems.forEach(item => {
        const courseId = item.getAttribute('data-course');
        if (courseId) {
            item.classList.add('hidden-course');
            const hideBtn = item.querySelector('.admin-btn:nth-last-child(2)');
            if (hideBtn) hideBtn.textContent = 'Unhide';
            hiddenCourses.push(courseId);
        }
    });
    
    localStorage.setItem('hiddenCourses', JSON.stringify(hiddenCourses));
    updateStudentView();
    alert('All courses have been hidden from students');
}

function showAllCourses() {
    const allCourseItems = document.querySelectorAll('.course-item');
    
    allCourseItems.forEach(item => {
        item.classList.remove('hidden-course');
        const hideBtn = item.querySelector('.admin-btn:nth-last-child(2)');
        if (hideBtn) hideBtn.textContent = 'Hide';
    });
    
    localStorage.setItem('hiddenCourses', JSON.stringify([]));
    updateStudentView();
    alert('All courses are now visible to students');
}

function manageStudents(courseName) {
    showStudentManagementSection(courseName);
}

function showStudentManagementSection(courseName) {
    document.getElementById('managementTitle').textContent = `Manage Students - ${courseName}`;
    const enrollments = JSON.parse(localStorage.getItem('courseEnrollments') || '{}');
    const enrolledStudents = enrollments[courseName] || [];
    
    const studentListDiv = document.getElementById('studentList');
    
    if (enrolledStudents.length === 0) {
        studentListDiv.innerHTML = '<p>No students enrolled in this course.</p>';
    } else {
        let studentHTML = `<p><strong>Total Enrolled: ${enrolledStudents.length} students</strong></p>`;
        enrolledStudents.forEach(student => {
            const studentName = typeof student === 'string' ? student : student.username;
            const department = typeof student === 'object' ? student.department || 'N/A' : 'N/A';
            const batch = typeof student === 'object' ? student.batch || 'N/A' : 'N/A';
            
            studentHTML += `
                <div class="student-item">
                    <div class="student-info">
                        <div class="student-name"><strong>${studentName}</strong></div>
                        <div class="student-details">Department: ${department} | Batch: ${batch}</div>
                    </div>
                    <div>
                        <button class="admin-btn" onclick="editStudentProfile('${studentName}')">Edit Profile</button>
                        <button class="remove-student-btn" onclick="removeStudent('${courseName}', '${studentName}')">Remove</button>
                    </div>
                </div>
            `;
        });
        studentListDiv.innerHTML = studentHTML;
    }
    
    showSection('studentManagement');
}

function removeStudent(courseName, studentName) {
    if (confirm(`Remove ${studentName} from ${courseName}?`)) {
        const enrollments = JSON.parse(localStorage.getItem('courseEnrollments') || '{}');
        if (enrollments[courseName]) {
            enrollments[courseName] = enrollments[courseName].filter(student => {
                const name = typeof student === 'string' ? student : student.username;
                return name !== studentName;
            });
            localStorage.setItem('courseEnrollments', JSON.stringify(enrollments));
            showStudentManagementSection(courseName); // Refresh the list
            alert(`${studentName} has been removed from ${courseName}`);
        }
    }
}

function editStudentProfile(studentName) {
    const newDepartment = prompt(`Edit Department for ${studentName}:`, 'Computer Science');
    if (!newDepartment) return;
    
    const newBatch = prompt(`Edit Batch for ${studentName}:`, '2021-2025');
    if (!newBatch) return;
    
    // Update student profile in all enrolled courses
    const enrollments = JSON.parse(localStorage.getItem('courseEnrollments') || '{}');
    let updated = false;
    
    for (const courseName in enrollments) {
        const studentIndex = enrollments[courseName].findIndex(student => {
            const name = typeof student === 'string' ? student : student.username;
            return name === studentName;
        });
        
        if (studentIndex !== -1) {
            enrollments[courseName][studentIndex] = {
                username: studentName,
                department: newDepartment,
                batch: newBatch
            };
            updated = true;
        }
    }
    
    if (updated) {
        localStorage.setItem('courseEnrollments', JSON.stringify(enrollments));
        alert(`Profile updated for ${studentName}\nDepartment: ${newDepartment}\nBatch: ${newBatch}`);
        // Refresh current view
        location.reload();
    }
}

function addCourseToDOM(courseData) {
    const loginType = localStorage.getItem('loginType');
    const courseId = courseData.name.toLowerCase().replace(/\s+/g, '-');
    
    // Save course to localStorage
    const savedCourses = JSON.parse(localStorage.getItem('savedCourses') || '[]');
    savedCourses.push(courseData);
    localStorage.setItem('savedCourses', JSON.stringify(savedCourses));
    
    // Create course item HTML
    const courseHTML = `
        <div class="course-item" data-course="${courseId}">
            <h3>${courseData.name}</h3>
            <p><strong>Category:</strong> ${courseData.category}</p>
            <p><strong>Instructor:</strong> ${courseData.instructor}</p>
            <p>${courseData.description}</p>
            <div class="admin-course-controls" style="display:${loginType === 'admin' ? 'block' : 'none'};">
                <label>Student Limit:</label>
                <select class="limit-dropdown">
                    <option value="no-limit" ${courseData.limit === 'no-limit' ? 'selected' : ''}>No Limit</option>
                    <option value="50" ${courseData.limit === '50' ? 'selected' : ''}>50 Students</option>
                    <option value="100" ${courseData.limit === '100' ? 'selected' : ''}>100 Students</option>
                    <option value="150" ${courseData.limit === '150' ? 'selected' : ''}>150 Students</option>
                    <option value="200" ${courseData.limit === '200' ? 'selected' : ''}>200 Students</option>
                    <option value="250" ${courseData.limit === '250' ? 'selected' : ''}>250 Students</option>
                    <option value="above-250" ${courseData.limit === 'above-250' ? 'selected' : ''}>Above 250</option>
                </select>
                <button class="admin-btn" onclick="editCourse('${courseId}')">Edit</button>
                <button class="admin-btn delete" onclick="deleteCourse('${courseId}')">Delete</button>
                <button class="admin-btn" onclick="toggleCourseVisibility('${courseId}')">Hide</button>
                <button class="admin-btn" onclick="manageStudents('${courseData.name}')">Manage Students</button>
            </div>
            <button class="enroll-btn" onclick="enrollCourse('${courseData.name}')">View/Enroll</button>
        </div>
    `;
    
    // Add to all courses
    document.getElementById('all-courses').insertAdjacentHTML('beforeend', courseHTML);
    
    // Add to specific category tab
    if (courseData.category === 'Technical') {
        document.getElementById('technical-courses').insertAdjacentHTML('beforeend', courseHTML);
    } else {
        document.getElementById('non-technical-courses').insertAdjacentHTML('beforeend', courseHTML);
    }
}

function updateStudentView() {
    const loginType = localStorage.getItem('loginType');
    const hiddenCourses = JSON.parse(localStorage.getItem('hiddenCourses') || '[]');
    
    if (loginType === 'student') {
        hiddenCourses.forEach(courseId => {
            const courseItems = document.querySelectorAll(`[data-course="${courseId}"]`);
            courseItems.forEach(item => {
                item.style.display = 'none';
            });
        });
    }
}

// Generate batch options dynamically based on course context
function generateBatchOptions(courseName = null) {
    const currentYear = new Date().getFullYear();
    const batchSelects = ['studentBatch', 'detailsBatch'];
    
    // Define course-specific start years
    const courseStartYears = {
        'Psychology': 2019,
        'Data Science': 2024
    };
    
    batchSelects.forEach(selectId => {
        const select = document.getElementById(selectId);
        if (select) {
            // Clear existing options except the first one
            while (select.children.length > 1) {
                select.removeChild(select.lastChild);
            }
            
            // Add "All Batches" option for details batch only
            if (selectId === 'detailsBatch') {
                const allOption = document.createElement('option');
                allOption.value = 'All Batches';
                allOption.textContent = 'All Batches';
                select.appendChild(allOption);
            }
            
            // Determine start year based on course
            let startYear = 1963; // Default start year
            if (courseName && courseStartYears[courseName]) {
                startYear = courseStartYears[courseName];
            }
            
            // Generate batches from determined start year to current year + 1
            for (let year = startYear; year <= currentYear + 1; year++) {
                const endYear = year + 3;
                const batchValue = `${year}-${endYear}`;
                const option = document.createElement('option');
                option.value = batchValue;
                option.textContent = batchValue;
                select.appendChild(option);
            }
        }
    });
}

// Check login status on page load
document.addEventListener('DOMContentLoaded', function() {
    const loginType = localStorage.getItem('loginType');
    const username = localStorage.getItem('username');
    
    if (loginType && username) {
        if (loginType === 'admin') {
            document.getElementById('userInfo').textContent = 'Logged in as: Admin';
            // Show admin controls
            document.getElementById('adminControls').style.display = 'block';
            document.querySelectorAll('.admin-course-controls').forEach(control => {
                control.style.display = 'block';
            });
            
            // Load courses only when needed - defer heavy operations
            setTimeout(() => {
                loadAdminCourses();
            }, 100);
        } else {
            document.getElementById('userInfo').textContent = `Logged in as: ${username}`;
            
            // Load courses only when needed - defer heavy operations
            setTimeout(() => {
                loadStudentCourses();
            }, 100);
        }
    }
    
    // Check if undo button should be shown
    if (localStorage.getItem('lastUploadBackup')) {
        const undoBtn = document.getElementById('undoBtn');
        if (undoBtn) undoBtn.style.display = 'inline-block';
    }
    
    // Generate batch options
    generateBatchOptions();
    
    // Add event listeners
    addEventListeners();
});

function loadAdminCourses() {
    const savedCourses = JSON.parse(localStorage.getItem('savedCourses') || '[]');
    savedCourses.forEach(courseData => {
        const courseId = courseData.name.toLowerCase().replace(/\s+/g, '-');
        const existingDefaultCourse = document.querySelector(`[data-course="${courseId}"]`);
        if (existingDefaultCourse) {
            document.querySelectorAll(`[data-course="${courseId}"]`).forEach(instance => instance.remove());
        }
        addCourseToDOM(courseData);
    });
    
    const hiddenCourses = JSON.parse(localStorage.getItem('hiddenCourses') || '[]');
    hiddenCourses.forEach(courseId => {
        document.querySelectorAll(`[data-course="${courseId}"]`).forEach(item => {
            item.classList.add('hidden-course');
            const hideBtn = item.querySelector('.admin-btn:nth-last-child(2)');
            if (hideBtn) hideBtn.textContent = 'Unhide';
        });
    });
}

function loadStudentCourses() {
    const savedCourses = JSON.parse(localStorage.getItem('savedCourses') || '[]');
    savedCourses.forEach(courseData => {
        const courseId = courseData.name.toLowerCase().replace(/\s+/g, '-');
        if (!document.querySelector(`[data-course="${courseId}"]`)) {
            addCourseToDOM(courseData);
        }
    });
    updateStudentView();
}

function addEventListeners() {
    document.getElementById('helpdeskForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const email = document.getElementById('userEmail').value;
        const message = document.getElementById('userMessage').value;
        
        try {
            const response = await fetch('http://localhost:5000/send-email', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, message })
            });
            const result = await response.json();
            
            if (result.success) {
                alert('Message sent successfully!');
                document.getElementById('helpdeskForm').reset();
            } else {
                alert('Error: ' + result.message);
            }
        } catch (error) {
            alert('Error: Make sure Python server is running on port 5000');
        }
    });
    
    document.getElementById('addCourseForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const courseData = {
            name: document.getElementById('courseName').value,
            category: document.getElementById('courseCategory').value,
            instructor: document.getElementById('instructorName').value,
            description: document.getElementById('courseDescription').value,
            limit: document.getElementById('studentLimit').value,
            duration: document.getElementById('courseDuration').value,
            durationMinutes: document.getElementById('courseDurationMinutes').value,
            prerequisites: document.getElementById('coursePrerequisites').value
        };
        
        addCourseToDOM(courseData);
        alert(`Course created: ${courseData.name}`);
        document.getElementById('addCourseForm').reset();
        showSection('courses');
    });
    
    document.getElementById('studentEnrollmentForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const courseName = localStorage.getItem('enrollingCourse');
        const username = localStorage.getItem('username');
        const department = document.getElementById('studentDepartment').value;
        const batch = document.getElementById('studentBatch').value;
        
        const enrollments = JSON.parse(localStorage.getItem('courseEnrollments') || '{}');
        if (!enrollments[courseName]) enrollments[courseName] = [];
        
        enrollments[courseName].push({
            username, department, batch,
            enrolledDate: new Date().toISOString()
        });
        localStorage.setItem('courseEnrollments', JSON.stringify(enrollments));
        
        document.getElementById('enrollmentDetails').innerHTML = `
            <p><strong>Course:</strong> ${courseName}</p>
            <p><strong>Student:</strong> ${username}</p>
            <p><strong>Department:</strong> ${department}</p>
            <p><strong>Batch:</strong> ${batch}</p>
            <p style="color: green; font-weight: bold;">Successfully enrolled!</p>
        `;
        
        document.getElementById('studentEnrollmentForm').reset();
        localStorage.removeItem('enrollingCourse');
        showSection('enrollmentSuccess');
    });
    
    document.getElementById('editCourseForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const courseId = localStorage.getItem('editingCourseId');
        const savedCourses = JSON.parse(localStorage.getItem('savedCourses') || '[]');
        const courseIndex = savedCourses.findIndex(course => 
            course.name.toLowerCase().replace(/\s+/g, '-') === courseId
        );
        
        if (courseIndex !== -1) {
            savedCourses[courseIndex] = {
                name: document.getElementById('editCourseName').value,
                category: document.getElementById('editCourseCategory').value,
                instructor: document.getElementById('editInstructorName').value,
                description: document.getElementById('editCourseDescription').value,
                limit: document.getElementById('editStudentLimit').value,
                duration: document.getElementById('editCourseDuration').value,
                durationMinutes: document.getElementById('editCourseDurationMinutes').value,
                prerequisites: document.getElementById('editCoursePrerequisites').value
            };
            localStorage.setItem('savedCourses', JSON.stringify(savedCourses));
            location.reload();
        }
        localStorage.removeItem('editingCourseId');
    });
}

function showStudentDetailsPage() {
    const username = localStorage.getItem('username');
    const enrollments = JSON.parse(localStorage.getItem('courseEnrollments') || '{}');
    
    let studentProfile = { department: 'N/A', batch: 'N/A' };
    for (const course in enrollments) {
        const student = enrollments[course].find(s => s.username === username);
        if (student) {
            studentProfile = { department: student.department, batch: student.batch };
            break;
        }
    }
    
    document.getElementById('studentInfo').innerHTML = `
        <div class="student-profile">
            <h3>Profile Information</h3>
            <p><strong>Name:</strong> ${username}</p>
            <p><strong>Department:</strong> ${studentProfile.department}</p>
            <p><strong>Batch:</strong> ${studentProfile.batch}</p>
        </div>
    `;
    
    const ongoingCourses = [];
    const completedCourses = [];
    
    for (const courseName in enrollments) {
        const student = enrollments[courseName].find(s => s.username === username);
        if (student) {
            const status = getCourseStatus(courseName, student);
            const timeInfo = getTimeRemaining(courseName, student);
            
            if (status === 'completed') {
                completedCourses.push({ name: courseName, status: 'completed' });
            } else {
                ongoingCourses.push({ name: courseName, status: 'ongoing', timeInfo });
            }
        }
    }
    
    document.getElementById('ongoingCourses').innerHTML = ongoingCourses.length > 0 ? 
        ongoingCourses.map(course => `
            <div class="course-status-item ongoing">
                <h4>${course.name}</h4>
                <p><strong>Status:</strong> <span style="color: #ffc107;">Ongoing</span></p>
                <div class="time-remaining ${course.timeInfo.isUrgent ? 'urgent' : ''}">
                    <strong>Time Remaining:</strong> ${course.timeInfo.display}
                </div>
            </div>
        `).join('') : '<p>No ongoing courses.</p>';
    
    document.getElementById('completedCourses').innerHTML = completedCourses.length > 0 ?
        completedCourses.map(course => `
            <div class="course-status-item completed">
                <h4>${course.name}</h4>
                <p><strong>Status:</strong> <span style="color: #28a745;">Completed</span></p>
            </div>
        `).join('') : '<p>No completed courses.</p>';
    
    // Start timer updates
    startCourseTimers();
}

function getCourseStatus(courseName, student) {
    // Check if courseStatus is explicitly set from Excel upload
    if (student.courseStatus) {
        return student.courseStatus;
    }
    
    // Otherwise use time-based calculation
    const timeInfo = getTimeRemaining(courseName, student);
    return timeInfo.remaining <= 0 ? 'completed' : 'ongoing';
}

function getTimeRemaining(courseName, student) {
    // Get course duration
    const savedCourses = JSON.parse(localStorage.getItem('savedCourses') || '[]');
    let courseDuration = { hours: 1, minutes: 0 }; // Default
    
    const courseData = savedCourses.find(course => course.name === courseName);
    if (courseData) {
        courseDuration = { hours: parseInt(courseData.duration) || 0, minutes: parseInt(courseData.durationMinutes) || 0 };
    } else {
        // Check default courses
        if (courseName === 'Python Programming') {
            courseDuration = { hours: 2, minutes: 30 };
        } else if (courseName === 'Communication Skills') {
            courseDuration = { hours: 1, minutes: 45 };
        }
    }
    
    // Calculate time remaining
    const enrolledDate = new Date(student.enrolledDate || new Date());
    const totalDurationMs = (courseDuration.hours * 60 + courseDuration.minutes) * 60 * 1000;
    const completionDate = new Date(enrolledDate.getTime() + totalDurationMs);
    const now = new Date();
    const remaining = completionDate.getTime() - now.getTime();
    
    if (remaining <= 0) {
        return { remaining: 0, display: 'Course Completed', isUrgent: false };
    }
    
    const hours = Math.floor(remaining / (1000 * 60 * 60));
    const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
    
    const isUrgent = remaining < 10 * 60 * 1000; // Less than 10 minutes
    
    let display;
    if (hours > 0) {
        display = `${hours}h ${minutes}m ${seconds}s`;
    } else if (minutes > 0) {
        display = `${minutes}m ${seconds}s`;
    } else {
        display = `${seconds}s`;
    }
    
    return { remaining, display, isUrgent };
}

function showCourseStatus(status) {
    const ongoingDiv = document.getElementById('ongoingCourses');
    const completedDiv = document.getElementById('completedCourses');
    const tabs = document.querySelectorAll('.course-status-tabs .tab-btn');
    
    if (ongoingDiv && completedDiv && tabs.length >= 2) {
        ongoingDiv.classList.remove('active');
        completedDiv.classList.remove('active');
        tabs[0].classList.remove('active');
        tabs[1].classList.remove('active');
        
        if (status === 'ongoing') {
            ongoingDiv.classList.add('active');
            tabs[0].classList.add('active');
        } else {
            completedDiv.classList.add('active');
            tabs[1].classList.add('active');
        }
    }
}

function startCourseTimers() {
    // Clear any existing timer
    if (window.courseTimer) {
        clearInterval(window.courseTimer);
    }
    
    // Update timers every second
    window.courseTimer = setInterval(() => {
        const username = localStorage.getItem('username');
        const enrollments = JSON.parse(localStorage.getItem('courseEnrollments') || '{}');
        let hasChanges = false;
        
        // Update time displays
        document.querySelectorAll('.time-remaining').forEach(timeDiv => {
            const courseItem = timeDiv.closest('.course-status-item');
            const courseName = courseItem.querySelector('h4').textContent;
            const student = enrollments[courseName]?.find(s => s.username === username);
            
            if (student) {
                const timeInfo = getTimeRemaining(courseName, student);
                timeDiv.innerHTML = `<strong>Time Remaining:</strong> ${timeInfo.display}`;
                timeDiv.className = `time-remaining ${timeInfo.isUrgent ? 'urgent' : ''}`;
                
                // Check if course is now completed
                if (timeInfo.remaining <= 0) {
                    hasChanges = true;
                }
            }
        });
        
        // Refresh the page if any course completed
        if (hasChanges) {
            showStudentDetailsPage();
        }
    }, 1000);
}

function showStudentsByDeptBatch() {
    const department = document.getElementById('detailsDepartment').value;
    const batch = document.getElementById('detailsBatch').value;
    
    if (!department || !batch) {
        alert('Please select both department and batch');
        return;
    }
    
    const enrollments = JSON.parse(localStorage.getItem('courseEnrollments') || '{}');
    const students = {};
    
    // Collect students based on department and batch selection
    for (const courseName in enrollments) {
        enrollments[courseName].forEach(student => {
            const matchesDept = department === 'All Departments' || student.department === department;
            const matchesBatch = batch === 'All Batches' || student.batch === batch;
            
            if (matchesDept && matchesBatch) {
                if (!students[student.username]) {
                    students[student.username] = {
                        name: student.username,
                        department: student.department,
                        batch: student.batch,
                        ongoing: [],
                        completed: []
                    };
                }
                
                const status = getCourseStatus(courseName, student);
                if (status === 'completed') {
                    students[student.username].completed.push(courseName);
                } else {
                    students[student.username].ongoing.push(courseName);
                }
            }
        });
    }
    
    // Generate cards
    let cardsHTML = '';
    const studentList = Object.values(students);
    
    if (studentList.length === 0) {
        const deptText = department === 'All Departments' ? 'All Departments' : department;
        const batchText = batch === 'All Batches' ? 'All Batches' : batch;
        cardsHTML = `<p style="text-align: center; color: #666; font-size: 18px; margin: 40px 0;">No students found for ${deptText} - ${batchText}</p>`;
    } else {
        studentList.forEach((student, index) => {
            const ongoingHTML = student.ongoing.length > 0 ? 
                student.ongoing.map(course => `<span class="ongoing">${course}</span>`).join(' ') : 
                '<span style="color: #999;">None</span>';
            
            const completedHTML = student.completed.length > 0 ? 
                student.completed.map(course => `<span class="completed">${course}</span>`).join(' ') : 
                '<span style="color: #999;">None</span>';
            
            const deptDisplay = department === 'All Departments' ? ` (${student.department})` : '';
            const batchDisplay = batch === 'All Batches' ? ` - ${student.batch}` : '';
            
            cardsHTML += `
                <div class="student-card">
                    <div class="student-header">${index + 1}. ${student.name}${deptDisplay}${batchDisplay}</div>
                    <div class="course-section">
                        <h4>Ongoing Courses:</h4>
                        <div class="course-list">${ongoingHTML}</div>
                    </div>
                    <div class="course-section">
                        <h4>Completed Courses:</h4>
                        <div class="course-list">${completedHTML}</div>
                    </div>
                </div>
            `;
        });
    }
    
    const deptText = department === 'All Departments' ? 'All Departments' : department;
    const batchText = batch === 'All Batches' ? 'All Batches' : batch;
    document.getElementById('reportTitle').textContent = `Student Report - ${deptText} (${batchText})`;
    document.getElementById('studentReportTable').innerHTML = cardsHTML;
    showSection('studentReport');
}

function uploadExcelCourses() {
    const fileInput = document.getElementById('excelFile');
    const file = fileInput.files[0];
    
    if (!file) {
        alert('Please select an Excel file');
        return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, {type: 'array'});
            const worksheet = workbook.Sheets[workbook.SheetNames[0]];
            const jsonData = XLSX.utils.sheet_to_json(worksheet);
            
            let successCount = 0;
            jsonData.forEach(row => {
                if (row.Name && row.Category && row.Instructor) {
                    const courseData = {
                        name: row.Name,
                        category: row.Category,
                        instructor: row.Instructor,
                        description: row.Description || '',
                        limit: row.Limit || 'no-limit',
                        duration: row['Duration (hours)'] || 1,
                        durationMinutes: row['Duration (minutes)'] || 0,
                        prerequisites: row.Prerequisites || ''
                    };
                    addCourseToDOM(courseData);
                    successCount++;
                }
            });
            
            alert(`Successfully uploaded ${successCount} courses!`);
            showSection('courses');
        } catch (error) {
            alert('Error reading Excel file. Please check the format.');
        }
    };
    reader.readAsArrayBuffer(file);
}

function downloadSampleExcel() {
    const sampleData = [
        ['Name', 'Category', 'Instructor', 'Description', 'Limit', 'Duration (hours)', 'Duration (minutes)', 'Prerequisites'],
        ['Data Structures', 'Technical', 'Dr. Johnson', 'Learn fundamental data structures and algorithms', '100', '3', '30', 'Basic Programming'],
        ['Web Development', 'Technical', 'Prof. Smith', 'Complete web development with HTML CSS JS', '150', '4', '0', 'HTML Basics'],
        ['Machine Learning', 'Technical', 'Dr. Anderson', 'Introduction to ML algorithms and applications', '50', '5', '15', 'Python Programming'],
        ['Digital Marketing', 'Non-Technical', 'Ms. Wilson', 'Learn digital marketing strategies and tools', '200', '2', '45', 'None'],
        ['Project Management', 'Non-Technical', 'Mr. Brown', 'Professional project management methodologies', '100', '3', '0', 'None'],
        ['Database Systems', 'Technical', 'Dr. Lee', 'Relational databases and SQL programming', '120', '4', '30', 'Basic Programming'],
        ['Public Speaking', 'Non-Technical', 'Ms. Davis', 'Improve presentation and communication skills', '80', '1', '30', 'None'],
        ['Cybersecurity', 'Technical', 'Prof. Garcia', 'Network security and ethical hacking basics', '75', '6', '0', 'Networking Fundamentals']
    ];
    
    const ws = XLSX.utils.aoa_to_sheet(sampleData);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Courses');
    XLSX.writeFile(wb, 'sample_courses.xlsx');
}

function uploadExcelStudents() {
    const fileInput = document.getElementById('studentExcelFile');
    const file = fileInput.files[0];
    
    if (!file) {
        alert('Please select an Excel file');
        return;
    }
    
    // Create backup before making changes
    const backup = {
        enrollments: JSON.parse(localStorage.getItem('courseEnrollments') || '{}'),
        studentAccounts: JSON.parse(localStorage.getItem('studentAccounts') || '[]'),
        timestamp: new Date().toISOString()
    };
    localStorage.setItem('lastUploadBackup', JSON.stringify(backup));
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, {type: 'array'});
            const worksheet = workbook.Sheets[workbook.SheetNames[0]];
            const jsonData = XLSX.utils.sheet_to_json(worksheet);
            
            const enrollments = JSON.parse(localStorage.getItem('courseEnrollments') || '{}');
            const studentAccounts = JSON.parse(localStorage.getItem('studentAccounts') || '[]');
            let successCount = 0;
            let newAccountsCount = 0;
            const uploadedUsernames = [];
            
            jsonData.forEach(row => {
                if (row.Username && row.Department && row.Batch) {
                    uploadedUsernames.push(row.Username);
                    
                    // Create student account if doesn't exist
                    const existingAccount = studentAccounts.find(acc => acc.username === row.Username);
                    if (!existingAccount) {
                        studentAccounts.push({
                            username: row.Username,
                            password: row.Username // Password same as username
                        });
                        newAccountsCount++;
                    }
                    
                    const ongoingCourses = row['Course Ongoing'] ? row['Course Ongoing'].split(',').map(c => c.trim()) : [];
                    const completedCourses = row['Course Completed'] ? row['Course Completed'].split(',').map(c => c.trim()) : [];
                    
                    // Add ongoing courses
                    ongoingCourses.forEach(courseName => {
                        if (courseName && courseName !== 'None') {
                            if (!enrollments[courseName]) enrollments[courseName] = [];
                            
                            const existingStudent = enrollments[courseName].find(s => s.username === row.Username);
                            if (!existingStudent) {
                                enrollments[courseName].push({
                                    username: row.Username,
                                    department: row.Department,
                                    batch: row.Batch,
                                    enrolledDate: new Date().toISOString(),
                                    courseStatus: 'ongoing'
                                });
                            }
                        }
                    });
                    
                    // Add completed courses
                    completedCourses.forEach(courseName => {
                        if (courseName && courseName !== 'None') {
                            if (!enrollments[courseName]) enrollments[courseName] = [];
                            
                            const existingStudent = enrollments[courseName].find(s => s.username === row.Username);
                            if (!existingStudent) {
                                enrollments[courseName].push({
                                    username: row.Username,
                                    department: row.Department,
                                    batch: row.Batch,
                                    enrolledDate: new Date(Date.now() - 365*24*60*60*1000).toISOString(),
                                    courseStatus: 'completed'
                                });
                            }
                        }
                    });
                    successCount++;
                }
            });
            
            // Store uploaded usernames for undo functionality
            localStorage.setItem('lastUploadUsernames', JSON.stringify(uploadedUsernames));
            
            localStorage.setItem('courseEnrollments', JSON.stringify(enrollments));
            localStorage.setItem('studentAccounts', JSON.stringify(studentAccounts));
            
            // Show undo button
            document.getElementById('undoBtn').style.display = 'inline-block';
            
            alert(`Successfully uploaded ${successCount} student records!\nCreated ${newAccountsCount} new student accounts.\nLogin credentials: username = password`);
            showSection('details');
        } catch (error) {
            alert('Error reading Excel file. Please check the format.');
        }
    };
    reader.readAsArrayBuffer(file);
}

function undoLastUpload() {
    const backup = localStorage.getItem('lastUploadBackup');
    const uploadedUsernames = JSON.parse(localStorage.getItem('lastUploadUsernames') || '[]');
    
    if (!backup) {
        alert('No upload to undo!');
        return;
    }
    
    if (confirm(`This will undo the last Excel upload and remove all data added.\nThis includes ${uploadedUsernames.length} student profiles and their course enrollments.\n\nAre you sure?`)) {
        try {
            const backupData = JSON.parse(backup);
            
            // Restore previous state
            localStorage.setItem('courseEnrollments', JSON.stringify(backupData.enrollments));
            localStorage.setItem('studentAccounts', JSON.stringify(backupData.studentAccounts));
            
            // Clear backup and uploaded usernames
            localStorage.removeItem('lastUploadBackup');
            localStorage.removeItem('lastUploadUsernames');
            
            // Hide undo button
            document.getElementById('undoBtn').style.display = 'none';
            
            alert(`Successfully undone the last upload!\nRemoved ${uploadedUsernames.length} student profiles and their enrollments.`);
        } catch (error) {
            alert('Error undoing upload. Please try again.');
        }
    }
}

function deleteAllExceptStudent1() {
    if (confirm('This will delete ALL student data except student1. Are you sure?')) {
        const enrollments = JSON.parse(localStorage.getItem('courseEnrollments') || '{}');
        const studentAccounts = JSON.parse(localStorage.getItem('studentAccounts') || '[]');
        
        // Keep only student1 in enrollments
        for (const courseName in enrollments) {
            enrollments[courseName] = enrollments[courseName].filter(student => 
                student.username === 'student1'
            );
        }
        
        // Keep only student1 in accounts
        const filteredAccounts = studentAccounts.filter(account => 
            account.username === 'student1'
        );
        
        localStorage.setItem('courseEnrollments', JSON.stringify(enrollments));
        localStorage.setItem('studentAccounts', JSON.stringify(filteredAccounts));
        
        alert('All student data deleted except student1');
    }
}

function downloadSampleStudentExcel() {
    const sampleData = [
        ['Username', 'Student Name', 'Department', 'Batch', 'Course Ongoing', 'Course Completed'],
        ['Priya1', 'Priya Sharma', 'Computer Science', '2021-2024', 'Python Programming,Web Development', 'Communication Skills'],
        ['Meera2', 'Meera Johnson', 'Data Science', '2024-2027', 'Data Structures', 'Python Programming,Digital Marketing'],
        ['Kavya3', 'Kavya Brown', 'Psychology', '2019-2022', 'Project Management', 'Public Speaking'],
        ['Sneha4', 'Sneha Wilson', 'Commerce', '2022-2025', 'Machine Learning,Database Systems', 'None'],
        ['Divya5', 'Divya Davis', 'English', '2020-2023', 'Cybersecurity', 'Web Development,Data Structures'],
        ['Akash7', 'Akash C Anand', 'Electronics and Communication system', '2021-2024', 'Cybersecurity,Web Development,Data Structures', 'Python Programming,Web Development,Communication Skills']
    ];
    
    const ws = XLSX.utils.aoa_to_sheet(sampleData);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Students');
    XLSX.writeFile(wb, 'sample_students.xlsx');
}

function logout() {
    localStorage.removeItem('loginType');
    localStorage.removeItem('username');
    window.location.href = "index.html";
}
</script>

</body>
</html>
